{% extends "base.html" %}
{% block content %}

<h1>Checkout</h1>

<!-- Order summary -->
<table class="table align-middle mt-3">
  <thead>
    <tr>
      <th>Product</th>
      <th>Qty</th>
      <th>Unit</th>
      <th>Subtotal</th>
    </tr>
  </thead>
  <tbody>
    {% for item in cart.items.all %}
    <tr>
      <td>{{ item.product.title }}</td>
      <td>{{ item.qty }}</td>
      <td>£{{ item.product.price }}</td>
      <td>£{{ item.subtotal }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<div class="d-flex justify-content-between align-items-center mb-4">
  <a href="{% url 'cart:view' %}" class="btn btn-outline-secondary">
    Back to cart
  </a>
  <h4 class="mb-0">Total: £{{ cart.total }}</h4>
</div>

<!-- Checkout details + submit to Stripe -->
<form method="post" action="{% url 'checkout:start_checkout' %}" class="mt-3" style="max-width: 500px;">
  {% csrf_token %}
  {{ form.non_field_errors }}

  <div class="mb-3">
    <label class="form-label">Full name</label>
    {{ form.full_name }}
    {% for error in form.full_name.errors %}
      <div class="text-danger small">{{ error }}</div>
    {% endfor %}
  </div>

  <div class="mb-3">
    <label class="form-label">Email address</label>
    {{ form.email }}
    {% for error in form.email.errors %}
      <div class="text-danger small">{{ error }}</div>
    {% endfor %}
  </div>

  <div class="mb-3">
    <label class="form-label">Address line 1</label>
    {{ form.address_line1 }}
  </div>

  <div class="mb-3">
    <label class="form-label">Address line 2</label>
    {{ form.address_line2 }}
  </div>

  <div class="mb-3">
    <label class="form-label">City</label>
    {{ form.city }}
  </div>

  <div class="mb-3">
    <label class="form-label">Postcode</label>
    {{ form.postcode }}
  </div>

  <button type="submit" class="btn btn-primary w-100">
    Continue to payment with Stripe
  </button>
</form>

{% endblock %}

{% block scripts %}

{% endblock %}

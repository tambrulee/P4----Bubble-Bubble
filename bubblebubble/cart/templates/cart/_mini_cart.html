{% if cart.items.all %}
  <div class="d-flex justify-content-between align-items-center mb-2">
    <p class="mb-0 text-muted small">Items in your cart</p>
    <a class="small" href="{% url 'cart:view' %}">View full cart</a>
  </div>

  <div class="vstack gap-2 bb-mini-cart-list">
    {% for item in cart.items.all %}
      <div class="bb-mini-item">

        <!-- Thumb -->
        <a class="bb-mini-thumb"
           href="{% url 'catalog:product_detail' item.product.slug %}"
           aria-label="View {{ item.product.title }}">
          {% if item.product.images.first %}
            <img src="{{ item.product.images.first.image.url }}"
                 alt="{{ item.product.images.first.alt_text|default:item.product.title }}">
          {% else %}
            <div class="bb-mini-thumb-fallback" aria-hidden="true">
              <i class="fa-solid fa-leaf"></i>
            </div>
          {% endif %}
        </a>

        <!-- Main -->
        <div class="bb-mini-main">
          <div class="bb-mini-top">
            <a class="bb-mini-title"
               href="{% url 'catalog:product_detail' item.product.slug %}">
              {{ item.product.title }}
            </a>
            <div class="bb-mini-price text-muted small">
              £{{ item.product.price|floatformat:2 }}
            </div>
          </div>

          <!-- Qty controls -->
          <div class="bb-mini-qty">
            <button type="button"
                    class="btn btn-sm btn-outline-secondary js-qty bb-mini-qty-btn"
                    data-action="dec"
                    data-update-url="{% url 'cart:update' item.id %}"
                    data-stock="{{ item.product.stock_qty }}"
                    aria-label="Decrease quantity of {{ item.product.title }}">
              <i class="fa-solid fa-minus"></i>
            </button>

            <input type="number"
                   class="form-control form-control-sm text-center js-qty-input bb-mini-qty-input"
                   value="{{ item.qty }}"
                   min="1"
                   max="{{ item.product.stock_qty }}"
                   inputmode="numeric"
                   data-update-url="{% url 'cart:update' item.id %}"
                   data-stock="{{ item.product.stock_qty }}"
                   aria-label="Quantity for {{ item.product.title }}">

            <button type="button"
                    class="btn btn-sm btn-outline-secondary js-qty bb-mini-qty-btn"
                    data-action="inc"
                    data-update-url="{% url 'cart:update' item.id %}"
                    data-stock="{{ item.product.stock_qty }}"
                    aria-label="Increase quantity of {{ item.product.title }}">
              <i class="fa-solid fa-plus"></i>
            </button>
          </div>
        </div>

        <!-- Right -->
        <div class="bb-mini-right text-end">
          <div class="bb-mini-subtotal">
            £{{ item.subtotal|floatformat:2 }}
          </div>

          <form method="post"
                action="{% url 'cart:remove' item.id %}"
                class="mt-1 js-mini-remove">
            {% csrf_token %}
            <button type="submit"
                    class="btn btn-sm btn-link text-danger p-0 bb-mini-remove">
              Remove
            </button>
          </form>

        </div>

      </div>

      {% if not forloop.last %}
        <hr class="bb-mini-divider">
      {% endif %}
    {% endfor %}
  </div>

  <hr class="my-3">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <span class="text-muted">Total</span>
    <span class="h5 mb-0">£{{ cart.total|floatformat:2 }}</span>
  </div>

  <div class="d-grid gap-2">
    <form method="post" action="{% url 'checkout:summary' %}">
      {% csrf_token %}
      <button class="btn btn-primary w-100" type="submit">Checkout</button>
    </form>

    <a class="btn btn-outline-secondary w-100"
       href="{% url 'cart:view' %}">
      View cart
    </a>
  </div>

{% else %}
  <div class="text-center py-4">
    <div class="mb-2">
      <i class="fa-solid fa-cart-shopping fa-lg text-muted"></i>
    </div>
    <p class="mb-3">Your cart is empty.</p>
    <a class="btn btn-outline-secondary"
       href="{% url 'catalog:product_list' %}">
      Continue shopping
    </a>
  </div>
{% endif %}

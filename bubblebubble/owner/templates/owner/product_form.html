{% extends "owner/base_owner.html" %}
{% block content %}

<div class="container py-4 owner-form-wrap">

  <!-- Header -->
  <div class="owner-pagehead">
    <div class="owner-pagehead__title">
      <h1 class="h3 mb-1">{{ mode }} product</h1>

      {% if product %}
        <p class="owner-subtitle mb-0">
          Editing: <strong>{{ product.title }}</strong>
          {% if product.slug %}<span class="owner-slug">/ {{ product.slug }}/</span>{% endif %}
        </p>
      {% else %}
        <p class="owner-subtitle mb-0">Create a new product listing</p>
      {% endif %}
    </div>
    <!-- Buttons -->
    <div class="owner-pagehead__actions">
      <a href="{% url 'owner:owner_dashboard' %}" class="btn btn-sm btn-outline-secondary">
        Dashboard
      </a>
      <a href="{% url 'owner:owner_products' %}" class="btn btn-sm btn-outline-secondary">
        Back to products
      </a>
    </div>
  </div>

  <!-- Form -->
  <form method="post" enctype="multipart/form-data" class="card owner-form-card">
    {% csrf_token %}

    {% if form.non_field_errors %}
      <div class="alert alert-danger m-3 mb-0">{{ form.non_field_errors }}</div>
    {% endif %}

    <div class="card-body p-3 p-sm-4">

      <!-- Product details -->
      <section class="owner-block">
        <header class="owner-block__head">
          <h2 class="owner-block__title">Product details</h2>
          <p class="owner-block__hint">Core info shown on the product page.</p>
        </header>

        <div class="row g-3">
          <div class="col-md-8">
            <label class="form-label fw-semibold" for="{{ form.title.id_for_label }}">Title</label>
            {{ form.title }}
            {% for error in form.title.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
          </div>

          <div class="col-md-6">
            <label class="form-label fw-semibold" for="{{ form.scent.id_for_label }}">Scent</label>
            {{ form.scent }}
            {% if form.scent.help_text %}<div class="form-text">{{ form.scent.help_text }}</div>{% endif %}
            {% for error in form.scent.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
          </div>

          <div class="col-md-6">
            <label class="form-label fw-semibold" for="{{ form.weight_g.id_for_label }}">Weight (g)</label>
            {{ form.weight_g }}
            {% if form.weight_g.help_text %}<div class="form-text">{{ form.weight_g.help_text }}</div>{% endif %}
            {% for error in form.weight_g.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
          </div>

          <div class="col-12">
            <label class="form-label fw-semibold" for="{{ form.description.id_for_label }}">Description</label>
            {{ form.description }}
            {% for error in form.description.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
          </div>
        </div>
      </section>

      <!-- Images -->
      <section class="owner-block">
        <header class="owner-block__head owner-block__head--row">
          <div>
            <h2 class="owner-block__title">Images</h2>
            <p class="owner-block__hint">Gallery images shown on the product page.</p>
          </div>

          {% if product %}
            <a class="btn btn-sm btn-outline-secondary" href="{% url 'owner:owner_product_images' product.pk %}">
              Manage gallery
            </a>
          {% endif %}
        </header>

        {% if product %}
          <div class="row g-3">
            {% for img in product.images.all %}
              <div class="col-6 col-md-3">
                <div class="card h-100 owner-img-card">
                  <img src="{{ img.image.url }}" class="card-img-top" alt="{{ img.alt_text|default:product.title }}">
                  <div class="card-body p-2">
                    <div class="small text-truncate owner-img-meta">
                      {{ img.alt_text|default:"(no alt text)" }}
                    </div>
                    <a class="btn btn-sm btn-danger w-100 mt-2"
                       href="{% url 'owner:owner_product_image_delete' img.pk %}">
                      Delete
                    </a>
                  </div>
                </div>
              </div>
            {% empty %}
              <p class="text-muted small mb-0">No images yet.</p>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-muted small mb-0">Save the product first to upload images.</p>
        {% endif %}
      </section>

      <!-- Tags -->
      <section class="owner-block">
        <header class="owner-block__head">
          <h2 class="owner-block__title">Tags</h2>
          <p class="owner-block__hint mb-0">
            Add comma-separated keywords (e.g. winter, woody, refillable).
          </p>
        </header>

        <label class="visually-hidden" for="{{ form.tags.id_for_label }}">Tags</label>
        {{ form.tags }}

        {% if form.tags.help_text %}
          <div class="form-text">{{ form.tags.help_text }}</div>
        {% endif %}

        <div class="form-text">
          Examples: <strong>winter</strong>, <strong>woody</strong>, <strong>refillable</strong>, <strong>gift</strong>, <strong>vegan</strong>
        </div>

        {% for error in form.tags.errors %}
          <div class="text-danger small mt-1">{{ error }}</div>
        {% endfor %}
      </section>

      <!-- Pricing & stock -->
      <section class="owner-block">
        <header class="owner-block__head">
          <h2 class="owner-block__title">Pricing & stock</h2>
          <p class="owner-block__hint">Keep stock accurate for customer trust.</p>
        </header>

        <div class="row g-3 align-items-end">
          <div class="col-md-4">
            <label class="form-label fw-semibold" for="{{ form.price.id_for_label }}">Price (Â£)</label>
            {{ form.price }}
            {% for error in form.price.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
          </div>

          <div class="col-md-4">
            <label class="form-label fw-semibold" for="{{ form.stock_qty.id_for_label }}">Stock quantity</label>
            {{ form.stock_qty }}
            {% for error in form.stock_qty.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
          </div>

          <div class="col-md-4">
            <div class="form-check mt-2">
              {{ form.active }}
              <label class="form-check-label" for="{{ form.active.id_for_label }}">Active (visible in shop)</label>
            </div>
            {% for error in form.active.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
          </div>
        </div>
      </section>

    </div>

    <!-- Footer -->
    <div class="card-footer owner-form-footer">
      <div class="owner-actions">
        <button class="btn btn-mm" type="submit" name="action" value="save_product">Save product</button>
        <a class="btn btn-mm-outline" href="{% url 'owner:owner_products' %}">Cancel</a>
      </div>
    </div>

  </form>

</div>

{% endblock content %}

{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Moon & Moss | Handmade & Organic Soaps</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="Moon &amp; Moss is a UK-based artisan soap and candle brand inspired by nature, quiet rituals, and sustainable living.">
    <meta name="keywords" content="Moon and Moss, artisan soap, handmade candles, natural skincare, eco friendly gifts, sustainable living, UK handmade">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{% static 'img/favicon.png' %}">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet">
    <!-- Your custom CSS -->
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    {% block extra_css %}{% endblock extra_css %}
    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/40f053d397.js"
            crossorigin="anonymous"></script>
  </head>
  <body>
    <!-- Toasts (global, top-right) -->
  {% if messages %}
  <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index:1080;">
    {% for message in messages %}
      <div class="toast
                  {% if 'success' in message.tags %} text-bg-success
                  {% elif 'error' in message.tags or 'danger' in message.tags %} text-bg-danger
                  {% elif 'warning' in message.tags %} text-bg-warning
                  {% else %} text-bg-secondary
                  {% endif %}
                  border-0 mb-2"
           data-autoshow="true"
           role="alert"
           aria-live="assertive"
           aria-atomic="true"
           data-bs-delay="3500">
        <div class="d-flex">
          <div class="toast-body">{{ message }}</div>
          <button type="button"
                  class="btn-close btn-close-white me-2 m-auto"
                  data-bs-dismiss="toast"
                  aria-label="Close"></button>
        </div>
      </div>
    {% endfor %}
  </div>
{% endif %}
    <!-- Navigation -->
    <nav class="navbar navbar-light navbar-pink bb-navbar sticky-top">
      <div class="container bb-nav-grid">

        <!-- LEFT: burger (mobile only) -->
        <div class="bb-nav-left d-lg-none">
          <button class="navbar-toggler border-0 bb-icon-button"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#mainNav"
                  aria-controls="mainNav"
                  aria-expanded="false"
                  aria-label="Toggle navigation">
            <span class="bb-icon"><i class="fa-solid fa-bars"></i></span>
          </button>
        </div>

        <!-- LOGO -->
        <div class="bb-nav-center">
          <a class="navbar-brand bb-brand" href="{% url 'catalog:home' %}">
            <img src="{% static 'img/logo.png' %}" alt="Moon & Moss" class="bb-logo">
          </a>
        </div>

        <!-- DESKTOP LINKS (inline, desktop only) -->
        <div class="bb-nav-links-wrap d-none d-lg-flex">
          <ul class="navbar-nav bb-nav-links bb-nav-links-desktop">
            <li class="nav-item"><a class="nav-link" href="{% url 'catalog:product_list' %}">Shop All</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'catalog:winter_isles' %}">Winter Isles</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'catalog:refillables' %}">Refillables</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'catalog:about' %}">Our Story</a></li>
          </ul>
        </div>

        <!-- RIGHT: icons -->
        <div class="bb-nav-right bb-nav-icons">
          
        {% if user.is_authenticated %}
          <div class="dropdown bb-account-dropdown">
            <button class="btn bb-icon-link dropdown-toggle"
                    type="button"
                    id="accountMenu"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                    aria-label="Account menu">
              <span class="bb-icon"><i class="fa-regular fa-user"></i></span>
            </button>

            <ul class="dropdown-menu dropdown-menu-end bb-dropdown" aria-labelledby="accountMenu">
              <li><a class="dropdown-item" href="{% url 'accounts:my_orders' %}">
                <i class="fa-regular fa-clipboard me-2"></i> My orders
              </a></li>

              <li><a class="dropdown-item" href="{% url 'cart:view' %}">
                <i class="fa-solid fa-cart-shopping me-2"></i> Cart
              </a></li>

              <li><a class="dropdown-item" href="{% url 'accounts:address_list' %}">
                <i class="fa-regular fa-address-book me-2"></i> Address book
              </a></li>

              {% if user.is_staff %}
                <li><hr class="dropdown-divider"></li>

                <li>
                  <a class="dropdown-item"
                    href="{% url 'owner:owner_dashboard' %}">
                    <i class="fa-solid fa-screwdriver-wrench me-2"></i>
                    Admin panel
                  </a>
                </li>
              {% endif %}

              <li><hr class="dropdown-divider"></li>

              <li><a class="dropdown-item" href="{% url 'accounts:logout' %}?next={{ request.get_full_path }}">
                <i class="fa-solid fa-right-from-bracket me-2"></i> Logout
              </a></li>
            </ul>
          </div>
        {% else %}
      <a href="{% url 'accounts:login' %}?next={{ request.get_full_path }}"
        class="bb-icon-link"
        title="Login">
        <span class="bb-icon"><i class="fa-regular fa-user"></i></span>
      </a>
    {% endif %}

          <a href="{% url 'cart:view' %}"
            class="bb-icon-link position-relative"
            title="Cart"
            data-bs-toggle="offcanvas"
            data-bs-target="#miniCart"
            aria-controls="miniCart">
            <span class="bb-icon"><i class="fa-solid fa-cart-shopping"></i></span>
            <span id="cart-count"
            class="position-absolute top-0 end-0 translate-middle badge rounded-pill text-bg-danger">
              {{ cart_count|default:0 }}
            </span>
          </a>
        </div>

      </div>

      <!-- MOBILE LINKS (collapse) -->
      <div class="bb-main-links navbar-collapse collapse d-lg-none" id="mainNav">
        <div class="container">
          <ul class="navbar-nav mx-auto bb-nav-links text-center">
            <li class="nav-item"><a class="nav-link" href="{% url 'catalog:product_list' %}">Shop All</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'catalog:winter_isles' %}">Winter Isles</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'catalog:refillables' %}">Refillables</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'catalog:about' %}">Our Story</a></li>
            {% if user.is_authenticated %}
              <li class="nav-item"><a class="nav-link" href="{% url 'accounts:my_orders' %}">My Orders</a></li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>

    <!-- Scrolling bar -->
    <div class="bb-promo-bar">
      <div class="bb-promo-track">
        <span>Free UK shipping when you spend over £40</span>
        <span>Hand-poured small batch soaps & candles</span>
        <span>Last date for guaranteed Christmas delivery – 19th December</span>
      </div>
    </div>
    <!-- Toast container for "Added to cart" -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3"
         style="z-index: 1080">
      <div id="cart-toast"
           class="toast align-items-center"
           data-autoshow="false"
           role="alert"
           aria-live="assertive"
           aria-atomic="true">
        <div class="d-flex">
          <div id="cart-toast-body" class="toast-body">Added to cart.</div>
          <button type="button"
                  class="btn-close me-2 m-auto"
                  data-bs-dismiss="toast"
                  aria-label="Close"></button>
        </div>
      </div>
    </div>

    <!-- Main -->
    <main class="container py-4">
      {% block content %}{% endblock content %}
    </main>

    <!-- MINI CART OFFCANVAS -->
    <div class="offcanvas offcanvas-end"
         tabindex="-1"
         id="miniCart"
         aria-labelledby="miniCartLabel"
         data-mini-url="{% url 'cart:mini' %}">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="miniCartLabel">Your cart</h5>
        <button type="button"
                class="btn-close"
                data-bs-dismiss="offcanvas"
                aria-label="Close"></button>
      </div>
      <div class="offcanvas-body">
        <div id="mini-cart-content">
          <div class="text-muted">Loading…</div>
        </div>
      </div>
    </div>
      <!-- Footer -->
  <footer class="bb-footer mt-5 pt-5 pb-4">
    <div class="container">

      <!-- Top: brand -->
      <div class="row g-4 align-items-start mb-4">

        <!-- Brand / About -->
        <div class="col-12">
          <div class="bb-footer-brand">
            <h6 class="text-uppercase mb-2">Moon &amp; Moss</h6>
            <p class="small mb-3 bb-footer-muted">
              Handmade organic soaps inspired by quiet rituals, nature, and slow living.
            </p>

            <div class="bb-footer-chips">
              <span class="bb-footer-chip"><i class="fa-solid fa-leaf" aria-hidden="true"></i> Vegan</span>
              <span class="bb-footer-chip"><i class="fa-solid fa-paw" aria-hidden="true"></i> Cruelty-free</span>
              <span class="bb-footer-chip"><i class="fa-solid fa-map-pin" aria-hidden="true"></i> Made in UK</span>
              <span class="bb-footer-chip"><i class="fa-solid fa-recycle" aria-hidden="true"></i> Sustainable</span>
            </div>

            <!-- Social (optional: keep even if you don’t have links yet) -->
            <div class="bb-footer-social mt-3">
              <a href="#" class="bb-social-link" aria-label="Instagram"><i class="fa-brands fa-instagram"></i></a>
              <a href="#" class="bb-social-link" aria-label="TikTok"><i class="fa-brands fa-tiktok"></i></a>
              <a href="#" class="bb-social-link" aria-label="Pinterest"><i class="fa-brands fa-pinterest"></i></a>
            </div>
          </div>
        </div>

      </div>

      <!-- Links -->
      <div class="row g-4">

        <!-- Information -->
        <div class="col-6 col-md-4">
          <h6 class="text-uppercase mb-2">Information</h6>
          <ul class="list-unstyled small mb-0 bb-footer-links">
            <li><a href="{% url 'delivery' %}">Delivery Information</a></li>
            <li><a href="{% url 'returns' %}">Returns &amp; Refunds</a></li>
            <li><a href="{% url 'faq' %}">FAQs</a></li>
            <li><a href="{% url 'contact' %}">Contact</a></li>
          </ul>
        </div>

        <!-- Legal -->
        <div class="col-6 col-md-4">
          <h6 class="text-uppercase mb-2">Legal</h6>
          <ul class="list-unstyled small mb-0 bb-footer-links">
            <li><a href="{% url 'terms' %}">Terms &amp; Conditions</a></li>
            <li><a href="{% url 'privacy' %}">Privacy Policy</a></li>
            <li><a href="{% url 'cookies' %}">Cookie Policy</a></li>
          </ul>
        </div>

        <!-- Quick shop -->
        <div class="col-12 col-md-4">
          <h6 class="text-uppercase mb-2">Shop</h6>
          <ul class="list-unstyled small mb-3 bb-footer-links">
            <li><a href="{% url 'catalog:product_list' %}">All products</a></li>
            <li><a href="{% url 'catalog:product_list' %}?tag=best-sellers">Best sellers</a></li>
            <li><a href="{% url 'catalog:product_list' %}?tag=limited">Limited edition</a></li>
          </ul>
        </div>

      </div>

      <!-- Bottom line -->
      <div class="bb-footer-bottom mt-4 pt-3">
        <span>© {{ now|default:"2025" }} Moon &amp; Moss</span>
        <span class="bb-footer-muted">Handmade • Organic • Ethical &amp; Sustainable</span>
      </div>

    </div>
  </footer>

  <!-- Bootstrap and Stripe -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <!-- External cart AJAX JS -->
    <script src="{% static 'js/cart.js' %}"></script>
    <!-- Toasts -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll('.toast[data-autoshow="true"]').forEach((el) => {
          bootstrap.Toast.getOrCreateInstance(el).show();
        });
      });
    </script>
    {% block extra_js %}{% endblock extra_js %}
    {% block scripts %}{% endblock scripts %}
  </body>
</html>
